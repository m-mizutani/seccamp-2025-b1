# セキュリティ・キャンプ2025 B1『クラウドプラットフォーム監視入門』講義プラン

## 基本情報
- **開催日時**: 8月12日（火曜日） 8:30-12:30
- **総時間**: 4時間（休憩含む）
- **対象**: 学生中心、社会人レベルの内容
- **環境**: AWS（他クラウドにも応用可能）

## 講義の目標
1. **理論理解**: クラウド環境特有のセキュリティ監視の課題と設計原則を体系的に学ぶ
2. **技術習得**: データレイクを活用したカスタム検知システムの実装手法を身につける
3. **実践応用**: 組織の成熟度に応じたセキュリティ監視戦略を策定できるようになる

## 全体構成・タイムスケジュール

### 8:30-10:10 (100分) - 理論編：クラウドセキュリティ監視の設計と実装戦略

#### 8:30-8:45 - 導入・概要 (15分)
- **自己紹介・アイスブレイク** (5分)
- **講義の目的と全体像** (10分)

#### 8:45-9:00 - クラウド環境の特徴とセキュリティ課題 (15分)
  - 責任共有モデルの詳細理解
  - スケーラビリティと可視性のトレードオフ
  - 動的インフラの監視課題（Auto Scaling、コンテナ、サーバーレス）
  - マルチアカウント・マルチリージョン環境の複雑性

#### 9:00-9:35 - クラウドセキュリティサービスとカスタム検知戦略 (35分)

- **クラウドプラットフォーム共通のセキュリティサービス概念**
  - **マネージド脅威検知サービス（GuardDuty, Cloud Security Command Center等）**
    - 機械学習ベースの脅威検知メカニズム
    - 検知可能な脅威タイプ：ネットワーク異常、マルウェア、不正アクセス
    - **限界：汎用的な脅威のみ、組織固有ルール・ビジネスロジック依存の異常は検知不可**
  
  - **セキュリティ統合管理サービス（Security Hub, Security Command Center等）**
    - セキュリティ状況の一元管理
    - コンプライアンスチェック自動化
    - **限界：定義済みルールベース、カスタムビジネスルール未対応**
  
  - **監査ログ・データレイクサービス（CloudTrail+Security Lake, Cloud Logging等）**
    - API監査ログの網羅的収集
    - 標準化フォーマット（OCSF、CEF等）によるクエリ効率化
    - **活用ポイント：カスタムルール実装の基盤として最適**

  - **構成管理・アセット監視サービス（Config, Cloud Asset Inventory等）**
    - **設定変更監視**: リソース設定の追跡・変更検知
    - **コンプライアンス監視**: セキュリティ設定基準との継続的比較
    - **アセットインベントリ**: 全リソースの可視化・棚卸し
    - **活用例**: 意図しない設定変更、権限エスカレーション検知

  - **インフラ監視データの活用**
    - **VPC/ネットワークフローログ**: 通信パターン異常検知
    - **DNS解決ログ**: C&C通信、データ漏洩検知
    - **ロードバランサーアクセスログ**: Webアプリケーション攻撃検知

- **🎯 カスタム検知が必要な実例とビジネスケース** (15分)
  - **実例1：金融機関での特権アカウント監視**
    ```
    ケース：銀行の夜間バッチ処理担当者が業務時間外に
    本番データベースに直接アクセス
    → GuardDuty：正常と判定（正当な認証情報使用）
    → カスタム検知：業務時間外 + 特権アカウント + DB直接アクセス = アラート
    ```
  
  - **実例2：SaaS企業での異常データアクセス**
    ```
    ケース：営業担当者が通常の10倍の顧客データをダウンロード
    → GuardDuty：検知できず（正常なAPI呼び出し）
    → カスタム検知：ユーザー行動ベースライン + データ量閾値 = 検知
    ```
  
  - **実例3：製造業でのサプライチェーンセキュリティ**
    ```
    ケース：委託開発者が本来アクセス不要な設計図データにアクセス
    → Security Hub：権限は正しく設定されていると判定
    → カスタム検知：役職 + アクセス先データ分類 + 時間パターン = 検知
    ```

  - **組織成熟度に応じたカスタム検知実装戦略**
    - スタートアップ：重要度別優先実装
    - 中堅企業：部門別カスタマイズ
    - 大企業：AI/ML活用高度化

#### 9:35-9:40 - 休憩 (5分)

#### 9:40-10:10 - クラウド監視環境のアーキテクチャ (30分)

- **セキュリティデータ収集の全体像**
  - インフラログ：VPC Flow Logs、DNS Logs、Load Balancer Logs
  - アプリケーションログ：Web サーバー、データベース、アプリケーション
  - セキュリティログ：認証ログ、API監査ログ、脅威検知ログ

- **データレイクアーキテクチャの基本設計**
  ```
  Raw Data (S3) → ETL処理 → 標準化Data Lake → クエリエンジン → 検知・分析
  ```

- **処理方式の選択**
  - ストリーミング：重大脅威の即座検知
  - バッチ処理：パターン分析、トレンド検知

### 10:10-10:15 (5分) - 休憩

### 10:15-12:00 (105分) - 実習編：AWS Security Lake実装

#### 10:15-10:30 - 実習環境とSecurity Lake概要
- **実習環境の説明**
  - 事前準備済みのTerraform構成
  - IAMロール・ポリシー設定
  - Security Lake設定済み環境

- **Security Lake とは**
  - Open Cybersecurity Schema Framework (OCSF)
  - パーケットベースのデータレイク
  - S3上のデータ構造とパーティション戦略

#### 10:30-11:00 - Lambda関数（Go）の基本実装とCI/CDセットアップ（30分）
- **実習1：事前準備済み環境の説明とセットアップ**
  - GitHub リポジトリのクローン（雛形コード提供済み）
  - Lambda関数テンプレートの理解
- **GitHub Actionによる自動デプロイ**
  - 事前設定済みのCI/CDパイプライン説明
  - コードプッシュ→自動ビルド→Lambda デプロイの流れ
  - デプロイ確認とログ確認
- **通知フローの理解**
  - Lambda → SNS → 監視ツール → Slack連携
  - アラート通知の確認方法

#### 11:00-11:25 - Security Lake基礎クエリとログ構造理解（25分）
- **対象ログソースの構造理解**
  - **VPC Flow Logs**: ネットワーク通信の可視化
  - **DNS Logs**: ドメイン解決パターンの分析  
  - **CloudTrail**: API操作の監査

- **OCSF基礎クエリ練習**
  - 提供済みクエリテンプレートの実行
  - 基本的なフィルタリング・集計の確認

### 11:25-12:00 - シナリオベース検知ルール実装演習（35分）

#### 実践シナリオ演習（参加者は3つから選択）
- **シナリオ1：ネットワーク異常通信検知（VPC Flow Logs活用）**
- **シナリオ2：DNS異常クエリ検知（DNS Logs活用）**
- **シナリオ3：特権エスカレーション検知（CloudTrail活用）**
- **実装フロー（各シナリオ共通）**
  1. **SQLクエリ作成**: 提供されたテンプレートをベースに検知ロジック実装
  2. **ローカルテスト**: サンプルデータでクエリ動作確認
  3. **Lambda統合**: Go関数内にSQLを組み込み
  4. **CI/CDデプロイ**: GitHubプッシュ→自動ビルド→Lambda配置
  5. **動作確認**: 実際のアラートがSlackに通知されることを確認

### 12:00-12:30 (30分) - 実装結果共有・まとめ・質疑応答

#### 12:00-12:15 - 実装結果共有とベストプラクティス
- **各参加者の実装結果発表** (10分)
  - 選択したシナリオと実装内容
  - 遭遇した課題と解決方法
- **ベストプラクティスの共有** (5分)
  - 効果的なクエリパターン
  - 誤検知削減のコツ

#### 12:15-12:30 - まとめ・次ステップ・質疑応答
- **講義の振り返り**
  - **理論**: クラウド環境固有のセキュリティ監視設計
  - **実践**: データレイク + カスタム検知の実装体験
  - **重要ポイント**: マネージドサービスの限界とカスタム検知の必要性

- **実運用に向けたロードマップ**
  - 検知ルールの継続的改善サイクル
  - 組織内でのセキュリティ監視チーム構築
  - より高度な分析・AI活用への発展

- **質疑応答・ディスカッション**

## 事前準備

### 講師側準備
1. **Terraform環境準備**
   ```hcl
   # Security Lake設定
   # Lambda関数テンプレート
   # IAMロール・ポリシー
   # Athena設定
   # SNS設定
   ```

2. **GitHub リポジトリ準備**
   - Lambda Go関数の雛形コード
   - GitHub Actions ワークフロー設定
   - 3シナリオ用SQLテンプレート

3. **実習用データ準備**
   - VPC Flow Logs、DNS Logs、CloudTrail サンプルデータ
   - 検知テスト用の疑似イベント

4. **通知システムセットアップ**
   - SNS → 監視ツール → Slack連携設定
   - アラート受信確認用チャンネル

5. **配布資料**
   - OCSF SQLリファレンス
   - GitHub Actions使用方法
   - 3シナリオ詳細仕様書

### 参加者側準備
- AWSアカウント（実習用、事前配布）
- GitHubアカウント
- ノートPC
- Git、AWS CLI設定済み
- Go基礎知識（簡単なレベル）
- Slack参加（アラート確認用）

## 実習詳細仕様

### 使用技術スタック
- **Infrastructure as Code**: Terraform
- **開発言語**: Go 1.x (AWS Lambda)
- **データストレージ**: AWS Security Lake (S3ベース)
- **クエリエンジン**: Amazon Athena
- **通知基盤**: Amazon SNS → 監視ツール → Slack
- **CI/CD**: GitHub Actions

### 実習で扱うログタイプ
1. **VPC Flow Logs**（ネットワークトラフィック）- ネットワーク異常通信検知
2. **DNS Logs**（ドメイン解決ログ）- マルウェアC&C通信検知
3. **AWS CloudTrail**（API呼び出しログ）- 特権エスカレーション検知

### 実習シナリオ例
1. **ネットワーク異常通信検知（VPC Flow Logs）**
   - 内部から外部への大量データ転送
   - 異常なポート通信パターン

2. **DNS異常クエリ検知（DNS Logs）**
   - DGA（Domain Generation Algorithm）疑いドメイン
   - 既知の悪性ドメインへのクエリ

3. **特権エスカレーション検知（CloudTrail）**
   - 短時間での大量権限変更操作
   - 管理者権限の異常な付与パターン

## 評価・フィードバック

### 実習評価ポイント
1. **技術的完成度**: SQLクエリの正確性・効率性、Go実装の品質
2. **実用性**: 検知ルールの実際のセキュリティ課題への適用可能性
3. **運用考慮**: 誤検知削減、パフォーマンス最適化への配慮
4. **セキュリティ視点**: 脅威モデルの理解と適切な検知ロジック

### 講義終了後のサポート
- **リソース提供**: 実習コードGitHubリポジトリ、詳細ドキュメント
- **継続学習**: 参考文献リスト、次ステップ学習パス
- **質問サポート**: フォローアップ質問対応（講義後1週間）

## 参考リソース・学習パス

### 技術資料
- **クラウドセキュリティ**: [AWS Security Best Practices](https://aws.amazon.com/security/security-resources/)
- **データ標準化**: [OCSF Documentation](https://schema.ocsf.io/)
- **セキュリティフレームワーク**: [NIST Cybersecurity Framework](https://www.nist.gov/cyberframework)

### 発展学習コース
1. **認定資格**: AWS Security Specialty、Google Cloud Security Engineer
2. **専門コース**: セキュリティアナリスト養成、SOC構築実践
3. **実践演習**: インシデントレスポンス訓練、脅威ハンティング 